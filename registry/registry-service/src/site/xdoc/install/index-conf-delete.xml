<?xml version="1.0" encoding="UTF-8"?>

<!--
  Copyright 2014, by the California Institute of Technology.
  ALL RIGHTS RESERVED. United States Government Sponsorship acknowledged.
  Any commercial use must be negotiated with the Office of Technology Transfer
  at the California Institute of Technology.

  This software is subject to U. S. export control laws and regulations
  (22 C.F.R. 120-130 and 15 C.F.R. 730-774). To the extent that the software
  is subject to U.S. export control laws and regulations, the recipient has
  the responsibility to obtain export licenses or other export authority as
  may be required before exporting such information to foreign countries or
  providing access to foreign nationals.

  $Id$
-->

<document>
  <properties>
    <title>Delete Existing Configuration</title>
    <author email="Sean.Hardman@jpl.nasa.gov">Sean Hardman</author>
  </properties>

  <body>
    <section name="Delete Existing Configuration">
      <p>This section details two different methods for deleting the Object Type Configuration from a Registry Service instance. Once the configuration packages have been deleted, see the Object Type Configuration sub-section of the <a href="index.html#General_Configuration">General Configuration</a> section for instructions on how to load the configuration.
      </p>

      <subsection name="Registry User Interface">
        <p>The easiest method for deleting the existing configuration, is to use the Registry User Interface component. If this component is installed in your environment, access the component from your favorite web browser (on the local server access end point <i>http://localhost:8080/registry-ui</i>), select the Registry Service instance from the pull-down menu and perform the following steps:
        </p>

        <ul>
          <li>Navigate to the <i>Packages</i> tab.</li>
          <li>Select the <i>Refresh</i> button.</li>
          <li>Among the list of packages, you will see four packages with the following <i>Names</i> (if the packages are not listed on the first page of results, enter the names below in the <i>Name</i> text box, one at a time, and select the <i>Refresh</i> button):</li>
          <ul>
            <li>Core Objects</li>
            <li>Core Associations</li>
            <li>PDS Associations</li>
            <li>PDS Objects</li>
          </ul>
          <li>Select the check box next to each of these packages and then select the <i>Delete</i> button.</li>
          <li>A series of pop-up messages will appear, one asking if you really want to delete the packages, one stating the deletion is commencing and then one each verifying the deletion of each package. Select the <i>OK</i> button for each of these.</li>
        </ul>
      </subsection>

      <subsection name="Command-Line Interface">
        <p>The alternative method for deleting the packages, is to determine the Global Unique Identifier (guid) for each package and then delete each one with a set of <i>cURL</i> commands. Access the Registry Service at the end point <i>http://localhost:8080/registry-pdsX/packages</i> (where <i>pdsX</i> is either <i>pds3</i> or <i>pds4</i>) from your favorite web browser. You should see a listing similar to the following (your listing may contain many packages):
        </p>

        <source>
&lt;ns2:response xmlns:ns2="http://registry.pds.nasa.gov" numFound="5" start="1"&gt;
&lt;ns2:results&gt;
  &lt;ns2:registryPackage
    versionName="1.0"
    description="This configures the core set of registry objects"
    status="Submitted" objectType="RegistryPackage" 
    name="Core Objects"
    lid="urn:uuid:83745882-7e8c-450b-ad20-dc5ba6b73fa6" 
    home="http://localhost:8080/registry" 
    guid="urn:uuid:149f202c-3832-4848-b27b-e21b83bed9b4"/&gt;
  ...
&lt;/ns2:results&gt;
&lt;/ns2:response&gt;
        </source>

        <p>Identify the four packages where the <i>name</i> attribute matches the list provided for the previous method. If the packages are not listed on the first page of results, modify the end point request to increase the number of packages returned as follows: <i>http://localhost:8080/registry-pdsX/packages?rows=X</i>. The value of <i>X</i> should be equal to the <i>numFound</i> attribute value from the initial request. Use the web browser's <i>Find</i> feature to identify the configuration packages and obtain their <i>guid</i> attribute value.
        </p>

        <p>Execute the following two <i>cURL</i> commands for each package (the first deletes the member products and the second deletes the package product):
        </p>

        <source>
% curl -X DELETE -v \
http://localhost:8080/registry-pdsX/packages/&lt;guid&gt;/members
% curl -X DELETE -v \
http://localhost:8080/registry-pdsX/packages/&lt;guid&gt;
        </source>
      </subsection>
    </section>
  </body>
</document>
