#!/bin/bash

####################################################################
#
# initial-index
#
# Script used to generate an index using the search-core, and call
# solr-post to post the data to the search-service
#
# $Id$
#
####################################################################

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

source ${DIR}/env-vars

PSA_FLAG=0

if [ $# -eq 3 ]; then
    SEARCH_HOME=${1}	
    SEARCH_SERVICE_URL=${2}
    REGISTRY_URL=${3}
	PSA_FLAG=${4}
elif [ "${SEARCH_HOME}" == "" ] || [ "${SEARCH_SERVICE_URL}" == "" ] || [ "${REGISTRY_URL}" == "" ]; then
    echo
    echo "Usage: `basename $0` <search-home> <search-service-url> <registry-url>"
    echo "    or specify variables in ${DIR}/env-vars"
    echo
    exit 1
fi

echo "-----------------------------------------------------"
echo "-----------------------------------------------------"
echo " - SEARCH_HOME = $SEARCH_HOME "
echo " - SEARCH_SERVICE_URL = $SEARCH_SERVICE_URL "
echo " - REGISTRY_URL = $REGISTRY_URL"
echo "-----------------------------------------------------"
echo "-----------------------------------------------------"

# Need SEARCH_HOME to specify we are using the PDS Solr instance
echo $SEARCH_HOME

# Check if search-core is in PATH
hash search-core 2>/dev/null || { echo >&2 "search-core must be installed in PATH.  Aborting."; exit 1; }

echo "-----Running search-core------"
search-core -H $SEARCH_HOME -r $REGISTRY_URL
echo "-----search-core Complete-----"

solr-post
