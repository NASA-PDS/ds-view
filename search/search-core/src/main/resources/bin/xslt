#!/bin/bash

####################################################################
#
# xslt
#
# Script to add faceting hierarchies to the Lucene indexed data
# using Saxon and XSLT.
#
# $Id$
#
####################################################################

# Check if the JAVA_HOME environment variable is set.
if [ -z "${JAVA_HOME}" ]; then
   echo "The JAVA_HOME environment variable is not set." 1>&2
   exit 1
fi

DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

source ${DIR}/env-vars

if [ $# -eq 4 ]; then
    INPUT=${1}
    STYLESHEET=${2}
    OUTPUT=${3}
    SEARCH_HOME=${4}
elif [ "${SEARCH_HOME}" == "" ]; then
    echo 1>&2
    echo "Usage: `basename $0` <input-xml> <stylesheet> <output> <search-home>" 1>&2
    echo "    or specify variables in ${DIR}/env-vars" 1>&2
    echo 1>&2
    exit 1
fi

echo
echo "Running XSLT transformation..."
echo

echo $SEARCH_HOME
export SAXON_LIB=$SEARCH_HOME/../lib
CLASSPATH=`echo $SAXON_LIB/*.jar | sed -e 's/ /:/g'`


INPUT="-s:${INPUT}"
STYLESHEET="-xsl:${STYLESHEET}"
OUTPUT="-o:${OUTPUT}"

echo "java -Xmx256m -jar ${SAXON_LIB}/saxon-9.jar \"${INPUT}\" \"${STYLESHEET}\" \"${OUTPUT}\""
"${JAVA_HOME}"/bin/java -Xmx256m -jar ${SAXON_LIB}/saxon-9.jar "${INPUT}" "${STYLESHEET}" "${OUTPUT}"

exit 0
