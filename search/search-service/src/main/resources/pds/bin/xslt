#! /bin/bash

echo
echo "Running XSLT transformation..."
echo

if [ "$SOLR_HOME" != "" ]; then
    echo
    echo "SOLR_HOME = ${SOLR_HOME}"
    echo
elif [ "$1" != "" ]; then
    SOLR_HOME=${1}
    echo
    echo "SOLR_HOME = ${1}"
    echo
else
    echo
    echo "SOLR_HOME must be specified as environment var or command-line:  ./xslt <solr-home>"
    echo
    exit 0
fi

export SAXON_LIB=$SOLR_HOME/lib
CLASSPATH=`echo $SAXON_LIB/*.jar | sed -e 's/ /:/g'`

if [ $# -lt 2 ]; then
  echo "usage: $0 xmlFile stylesheet [outFile]"
  exit 1
fi

IN="-s:$1"
STYLESHEET="-xsl:$2"
shift 2

if [ $# -lt 1 ]; then
  java -jar $SAXON_LIB/saxon-9.jar "$IN" "$STYLESHEET"
else
  OUT="-o:$1"
  shift
  echo "java -Xmx256m -jar $SAXON_LIB/saxon-9.jar \"$IN\" \"$STYLESHEET\" \"$OUT\" \"$@\""
  java -Xmx256m -jar $SAXON_LIB/saxon-9.jar "$IN" "$STYLESHEET" "$OUT" "$@"
fi
