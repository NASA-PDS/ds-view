<?xml version="1.0" encoding="UTF-8"?>

<!-- 
  Copyright 2009-2010, by the California Institute of Technology.
  ALL RIGHTS RESERVED. United States Government Sponsorship acknowledged.
  Any commercial use must be negotiated with the Office of Technology 
  Transfer at the California Institute of Technology.

  This software is subject to U. S. export control laws and regulations 
  (22 C.F.R. 120-130 and 15 C.F.R. 730-774). To the extent that the software 
  is subject to U.S. export control laws and regulations, the recipient has 
  the responsibility to obtain export licenses or other export authority as 
  may be required before exporting such information to foreign countries or 
  providing access to foreign nationals.

  $Id$
-->

<document>
  <properties>
    <title>Installation</title>
    <author email="Sean.Hardman@jpl.nasa.gov">Sean Hardman</author>
  </properties>

  <body>
    <section name="Installation">
      <p>This section describes how to install the Profile Setup software web application contained in the <i>${xdoc-artifactId}</i> package. The following topics can be found in this section:
      </p>

      <ul>
        <li><a href="#System_Requirements">System Requirements</a></li>
        <li><a href="#Unpacking_the_Package">Unpacking the Package</a></li>
        <li><a href="#Creating_and_Loading_the_Database">Creating and Loading the Database</a></li>
        <li><a href="#Configuring_Database_Access">Configuring Database Access</a></li>
        <li><a href="#Configuring_Environment">Configuring Environment</a></li>
        <li><a href="#Deploying_the_Application">Deploying the Application</a></li>
      </ul>
    </section>

    <section name="System Requirements">
      <p>The Profile Setup web application was developed using Java and <a href="http://jquery.com/" target="_blank">jQuery</a> and will run under a standard Java Application Server. The application was specifically developed under Sun Java version 1.5, so the tool will execute correctly under versions 1.5 or 1.6.
      </p>

      <p>Since the tool was developed using Sun's Java, the target Java Application Server should support Sun's Java Runtime Environment (JRE). The application was tested using Apache's Tomcat version 5.5.X, which is the preferred Java Application Server for deployment. The software can be obtained from the <a href="http://tomcat.apache.org/" target="_blank"> Apache Tomcat</a> web site. Other Java Application Servers should be compatible.
      </p>

      <p>The Profile Setup software also requires a <a href="http://www.mysql.com/" target="_blank">MySQL</a> Server installation for hosting the Report Service database. The application was tested using the Community Server 5.X.X.
      </p>

      <p>The web application also requires that Sawmill (8.X.X) be installed on the local machine in order for the software to performs its duty of configuring profiles for the service as needed. See the <a href="http://pdscm/2010/report/install/index.html">Report Service Installation Instructions</a> for more detail.
      </p>
    </section>

    <section name="Unpacking the Package">
      <p>Download the <i>${xdoc-artifactId}</i> package from the <a href="http://starcell.jpl.nasa.gov/maven2/gov/nasa/pds/${xdoc-artifactId}/${xdoc-version}/" target="_blank">PDS Maven Repository</a>. The binary distribution is available in identical zip or tar/gzip packages. Unpack the selected binary distribution file with one of the following commands:
      </p>

      <source>
[node: ~] unzip ${xdoc-artifactId}-${xdoc-version}.zip
or
[node: ~] tar -xzvf ${xdoc-artifactId}-${xdoc-version}.tar.gz
      </source>

      <p>Note: Depending on the platform, the native version of <i>tar</i> may produce an error when attempting to unpack the distribution file because many of the file paths are greater than 100 characters. If available, the GNU version of tar will resolve this problem. If that is not available or cannot be installed, the zipped package will work just fine in a UNIX environment.
      </p>

      <p>The commands above result in the creation of the <i>${xdoc-artifactId}-${xdoc-version}</i> directory with the following directory structure:
      </p>

      <ul>
        <li><b>README.txt</b><br/>
          <p>A README file directing the user to the available documentation for the project.
          </p>
        </li>
        <li><b>LICENSE.txt</b><br/>
          <p>The copyright notice from the <a href="http://www.caltech.edu/" target="_blank">California Institute of Technology</a> detailing the restrictions regarding the use and distribution of this software. Although the license is strictly worded, the software has been classified as Technology and Software Publicly Available (TSPA) and is available for <i>anyone</i> to download and use.
          </p>
        </li>
        <li><b>${xdoc-artifactId}-${xdoc-version}.war</b><br/>
          <p>This is the Web Archive (WAR) file containing the Profile Setup software including all dependent JAR files. The application is intended to be hosted on the Engineering Node site but can be hosted elsewhere.
          </p>
        </li>
        <li><b>conf/</b><br/>
          <p>This configuration directory contains the SQL dump script for the Report Service database.
          </p>
        </li>
        <li><b>doc/</b><br/>
          <p>This document directory contains a local web site with the Profile Setup Guide, javadoc, unit test results and other configuration management related information. Just point your favorite browser to the <i>index.html</i> file in this directory.
          </p>
        </li>
      </ul>
    </section>

    <section name="Creating and Loading the Database">
      <p>The Profile Setup software requires a MySQL Server instance to host the Report Service database. If the target environment does not already have a MySQL Server instance installed, have an instance installed before continuing the installation. The software can be obtained from the <a href="http://www.mysql.com/" target="_blank">MySQL</a> web site.
      </p>

      <p>Once the MySQL Server instance is installed and/or identified, the database and user account for the Profile Setup software must be created. The following commands detail the steps for logging into the server, creating the database and creating the user account to access the database:
      </p>

      <source>
% mysql -u root -p
Enter password:

mysql> create database {database};
Query OK, 1 row affected (0.00 sec)

mysql> grant all on {database}.* to {username}@localhost identified by '{password}';
Query OK, 0 rows affected (0.00 sec)
      </source>

      <p>The values contained in the {} must correspond with the values in the <i>db_config.xml</i> file. See the <a href="#Configuring_Database_Access">Configuring Database Access</a> section for more details. Now that the database and corresponding account are available, it is time to load the database with a MySQL dump that contains the necessary tables for the database. The following commands will load the database:
      </p>

      <source>
% cd ${xdoc-artifactId}-${xdoc-version}/conf

% mysql -u {username} -p{password} {database} &lt; report_service_db.sql
      </source>

      <p>The above command can be run against a previously populated database since the script drops and recreates the tables each time it is loaded. Also note that there are no spaces between the <i>-p</i> argument and the password value.
      </p>
    </section>

    <section name="Configuring Database Access">
      <p>The Profile Setup software comes preconfigured to access the MySQL database instance on the operational machine. If this configuration requires modification, the WAR file will need to be unpacked and the <i>./WEB-INF/classes/db_config.xml</i> file modified. The file contents are as follows:
      </p>

      <source>
&lt;dbinfo&gt;
  &lt;url&gt;jdbc:mysql://{node}:{port}/{database}&lt;/url&gt;
  &lt;driver&gt;com.mysql.jdbc.Driver&lt;/driver&gt;
  &lt;user&gt;{username}&lt;/user&gt;
  &lt;password&gt;{password}&lt;/password&gt;
&lt;/dbinfo&gt;
      </source>

      <p>Modify the values contained in the {} according to the desired MySQL database instance, save the file and repack the WAR file.
      </p>
    </section>

    <section name="Configuring Environment">
      <p>The Profile Setup software comes preconfigured to create and modify Sawmill profiles as well as transfer web logs from remote locations. In order to ensure stable functionality, several environment variables must be set prior to application deployment. If this configuration requires modification, the WAR file will need to be unpacked and the <i>./WEB-INF/classes/db_config.xml</i> file modified. The file contents are as follows:
      </p>

      <source>
&lt;variables&gt;

  # The home directory of the Sawmill software containing the file sawmill.cgi
  &lt;sawmill_home&gt;{sawmill_home}&lt;/sawmill_home&gt;

  # The home directory for the Sawmill profiles (should be contained within sawmill home directory)
  &lt;sawmill_profile_home&gt;{sawmill_home}/LogAnalysisInfo/profiles&lt;/sawmill_profile_home&gt;

  # The destination directory to store all of the logs to be transferred.
  &lt;log_dest&gt;{log_destination}&lt;/log_dest&gt;

&lt;/variables&gt;
      </source>

      <p>Modify the values contained in the {} according to the desired machine directories, save the file and repack the WAR file.
      </p>
    </section>

    <section name="Deploying the Application">
      <p>The Profile Setup web application is packaged as a WAR file and is intended for installation under a standard Java Application Server. Prior to installation the WAR file should be renamed from <i>${xdoc-artifactId}-${xdoc-version}.war</i> to <i>${xdoc-artifactId}.war</i>. A WAR file is normally copied directly to the <i>webapps</i> directory or installed via the Manager interface. Once this step is complete, the application is ready for operation.
      </p>
    </section>
  </body>
</document>
