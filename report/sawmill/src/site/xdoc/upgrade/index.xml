<?xml version="1.0" encoding="UTF-8"?>

<!--
  Copyright 2010-2012, by the California Institute of Technology.
  ALL RIGHTS RESERVED. United States Government Sponsorship acknowledged.
  Any commercial use must be negotiated with the Office of Technology Transfer
  at the California Institute of Technology.

  This software is subject to U. S. export control laws and regulations
  (22 C.F.R. 120-130 and 15 C.F.R. 730-774). To the extent that the software
  is subject to U.S. export control laws and regulations, the recipient has
  the responsibility to obtain export licenses or other export authority as
  may be required before exporting such information to foreign countries or
  providing access to foreign nationals.

  $Id: index.xml 10031 2012-01-30 06:54:52Z shardman $
-->

<document>
  <properties>
    <title>Upgrade</title>
    <author email="Jordan.Padams@jpl.nasa.gov">Jordan Padams</author>
    <author email="Sean.Hardman@jpl.nasa.gov">Sean Hardman</author>
  </properties>

  <body>
    <section name="Upgrade">
      <p>This document describes how to upgrade the <a href="http://www.sawmill.net/" target="_blank">Sawmill</a> software package for versions 8.5+.  The current licenses apply to all 8.x.x.x versions.
      </p>

      <ul>
        <li><a href="#Download_Software">Download Software</a></li>
        <li><a href="#Software_Upgrade">Software Upgrade</a></li>
      </ul>
    </section>

      <section name="Download Software">
        <p>See <a href="../install/index.html#Download_Software">Download Software</a> section of Installation for instructions on downloading the software.
        </p>
      </section>

      <section name="Software Upgrade">
        <p>This section describes the procedure for upgrading a previously installed version of Sawmill to a newer version.
        </p>

	<table style="width:400px;">
	  <tr><th>Machine Name</th><th>Purpose</th></tr>
	  <tr><td>pdsrpt1</td><td>operations</td></tr>
	  <tr><td>pdsrpt2</td><td>operations</td></tr>
	</table>

	<p><i>Note: The following procedure needs to be completed for <b><u>pdsrpt1</u></b> only.  The instructions will explicitly denote instructions for upgrading pdsrpt2.</i></p>

        <ol>
          <li>Log onto the pdsrpt1.</li>
	  <li>Change to the pds user:
	    <source>
% sudo su pds
	    </source>
	  </li>
	  <li>Place the downloaded Sawmill tar in the /home/pds directory</li>
          <li>Navigate to /home/pds and enter the following command from the command line:
            <source>
% gunzip -c (sawmill.tar.gz) | tar xf -
            </source>
            <p>A directory called <i>sawmill</i> is created containing the software and configuration.
            </p>
          </li>
	  <li>Move the directory to a more version-specific location so it is maintained:
	    <source>
% mv sawmill sawmill8.6.3.1
	    </source>
	  </li>
	  <li><p>Kill all running sawmill processes.</p>
	    <source>
% killall sawmill
	    </source>
	  </li>
          <li><p>Recreate a new symbolic link to the current installation:</p>
            <source>
% rm /usr/local/report/sawmill
% ln -s /home/pds/sawmill8.6.3.1 /usr/local/report/sawmill
            </source>
          </li>
	  <li><p>Run <a href="http://starcell.jpl.nasa.gov/repo/2010/trunk/report/sawmill/src/main/resources/bin/upgrade-sawmill">upgrade-sawmill</a> to remove the Sawmill default configurations and copy the PDS Engineering-specific configurations from the old installation.</p>
	    <source>
% # Usage: upgrade-sawmill &lt;new-LogAnalysisInfo&gt;
% #  - &lt;new-LogAnalysisInfo&gt; - the LogAnalysisInfo directory within the new installation
%
% ./upgrade-sawmill /usr/local/report/sawmill/LogAnalysisInfo
	    </source>
	    <p><b>Note: This assumes <i>/report_service/LogAnalysisInfo</i> is home to load balanced LogAnalysisInfo config.  Update the script if needed.</b></p>
	  </li>
          <li>To run Sawmill, execute the following commands:
            <source>
% cd /usr/local/report/sawmill
% nohup ./sawmill -ws t -v e > /usr/local/report/sawmill_logs/&lt;current_date_in_YYYYMMDD_formate&gt;.log 2>&amp;1&amp;
            </source>
	    <p><i>Note: Be sure to modify this command, as needed for the shell being used, to ensure Sawmill runs as a daemon process and output is redirected into .</i>
	    </p>
          </li>
	  <li>Log onto pdsrpt2</li>
	  <li>Complete steps 1-6 from above on pdsrpt2</li>
	  <li><p>Perform the following in the bash shell:</p>
	    <source>
% rm -fr /usr/local/report/sawmill/LogAnalysisInfo
% ln -s /usr/local/report/LogAnalysisInfo /usr/local/report/sawmill/LogAnalysisInfo
	    </source>
	    <p><i>Note: Modify directories as needed to reflect actual installation directories.</i></p>
	  </li>
	  <li>Complete step 8 from above on pdsrpt2.</li>
          <li>Open a web browser and go to http://pdsrpt.jpl.nasa.gov/ to open Sawmill.</li>
          <li>Verify you can login using your PDS username and password.</li>
	  <li>Verify profiles appear as expected.</li>
          </ol>
      </section>

  </body>
</document>
