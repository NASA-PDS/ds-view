<?xml version="1.0" encoding="UTF-8"?>

<!--
  Copyright 2010-2012, by the California Institute of Technology.
  ALL RIGHTS RESERVED. United States Government Sponsorship acknowledged.
  Any commercial use must be negotiated with the Office of Technology Transfer
  at the California Institute of Technology.

  This software is subject to U. S. export control laws and regulations
  (22 C.F.R. 120-130 and 15 C.F.R. 730-774). To the extent that the software
  is subject to U.S. export control laws and regulations, the recipient has
  the responsibility to obtain export licenses or other export authority as
  may be required before exporting such information to foreign countries or
  providing access to foreign nationals.

  $Id$
-->

<document>
  <properties>
    <title>Installation</title>
    <author email="Jordan.Padams@jpl.nasa.gov">Jordan Padams</author>
    <author email="Sean.Hardman@jpl.nasa.gov">Sean Hardman</author>
  </properties>

  <body>
    <section name="Installation">
      <p>This document describes how to install the <a href="http://www.sawmill.net/" target="_blank">Sawmill</a> software package for versions 8.5+.  This software is the main component of the Report Service for the PDS 2010 system. The following topics can be found in this document:
      </p>

      <ul>
        <li><a href="#System_Requirements">System Requirements</a></li>
	<li><a href="#Initial_Setup">Initial Setup</a></li>
        <li><a href="#Software_Installation">Software Installation</a></li>
      </ul>
    </section>

    <section name="System Requirements">
      <p>This software will be installed with its own standalone web server, so there is no additional installations required.  However, there are some general memory, CPU, and disk space requirements outlined in the <a href="http://www.sawmill.net/cgi-bin/sawmill8/docs/sawmill.cgi?dp+docs.faq.entry+webvars.entry+systemrequirements+webvars.username+samples+webvars.password+sawmill">Sawmill documentation</a>.
      </p>
    </section>

    <section name="Initial Setup">
      <p>This installation assumes <i>/report_service</i> is a mounted drive containing the configuration and node logs.  A few directories and symbolic links are then assumed to be setup on the machine with <i>pds</i> as the owner:</p>
      <source>
% # Create report directory
% mkdir /usr/local/report
%
% # Create symbolic link to logs
% ln -s /report_service/logs /usr/local/report/logs
%
% # Create symbolic links to config
% ln -s /report_service/LogAnalysisInfo /usr/local/report/LogAnalysisInfo
%
% # Create symbolic link to old configurations
% ln -s /report_service/old_config /usr/local/report/old_config
%
% # Create directory for run logs
% mkdir /usr/local/report/sawmill_logs
      </source>
    </section>

    <section name="Software Installation">

      <subsection name="Download Software">
        <p>This section details how to download the software package from the Sawmill web site.
        </p>

        <ol>
          <li>Go to <a href="http://www.sawmill.net/downloads.html">http://www.sawmill.net/downloads.html</a>.</li>
          <li>Select the <i>Proceed</i> button (the form fields are optional).</li>
          <li>Select the desired version from the drop-down box, and select the <i>Proceed</i> button (latest and greatest preferred).</li>
          <li>Select the appropriate operating system for the host machine, and select the <i>Proceed</i> button.</li>
          <li>Select the appropriate hardware for the host machine, and select the <i>Proceed</i> button.</li>
          <li>The download will begin automatically.</li>
          <li>Verify that the <i>Operating System</i> and <i>Hardware Architecture</i> noted at the top of the page match that of the host machine.</li>
        </ol>
      </subsection>

      <subsection name="Web Server Mode Installation">
        <p>This section details the web server mode installation where Sawmill runs on its own standalone web server.
        </p>

	<p><i>The following procedure needs to be completed for <b><u>all</u></b> machines listed in the following table:</i></p>
	
	<table style="width:400px;">
	  <tr><th>Machine Name</th><th>Purpose</th></tr>
	  <tr><td>pdsrpt1</td><td>operations</td></tr>
	  <tr><td>pdsrpt2</td><td>operations</td></tr>
	</table>

        <ol>
          <li>Log onto the machine.</li>
	  <li>Change to pds user:
	    <source>
% sudo su pds
	    </source>
</li>
	  <li>Place the Sawmill tar in the /home/pds directory</li>
          <li>Navigate to /home/pds and enter the following command from the command line:
            <source>
% gunzip -c (sawmill.tar.gz) | tar xf -
            </source>
            <p>A directory called <i>sawmill</i> is created containing the software and configuration.
            </p>
          </li>
	  <li>Move the directory to a more version-specific location so it is maintained:
	    <source>
% mv sawmill sawmill8.6.3.1
	    </source>
	  </li>
	  <li><p>Create a symbolic link to the current installation:</p>
	    <source>
% ln -s /home/pds/sawmill8.6.3.1 /usr/local/report/sawmill
	    </source>
	  </li>
	  <li><p>Run <a href="http://starcell.jpl.nasa.gov/repo/2010/trunk/report/sawmill/src/main/resources/bin/install-sawmill">install-sawmill</a> to remove the Sawmill default configurations and checkout the PDS Engineering-specific configurations from the repository.</p>
	    <source>
# Usage: install-sawmill &lt;new-LogAnalysisInfo&gt;
#  - &lt;new-LogAnalysisInfo&gt; - the LogAnalysisInfo directory within the new installation
./install-sawmill /usr/local/report/sawmill/LogAnalysisInfo
	    </source>
	  </li>
          <li>To run Sawmill, execute the following commands:
            <source>
cd /usr/local/report/sawmill
nohup ./sawmill -ws t -v e > /usr/local/report/sawmill/sawmill_logs/&lt;current_date_in_YYYYMMDD_formate&gt;.log 2>&amp;1&amp;
            </source>
	    <p><i>Note: Be sure to modify this command, as needed for shell, to ensure Sawmill runs as a daemon process and output is redirected into .</i>
	    </p>
          </li>
	  <li>Update $APACHE_HOME/conf/httpd.conf as follows in order to redirect the URL to the Sawmill installation:
	    <source>
ProxyPass / http://localhost.jpl.nasa.gov:8988/
ProxyPassReverse / http://localhost.jpl.nasa.gov:8988/

ProxyPass /picts/ http://localhost.jpl.nasa.gov:8988/picts/
ProxyPassReverse /picts/ http://localhost.jpl.nasa.gov:8988/picts/
	    </source>
	  </li>
	  <li>Restart Apache.</li>
          <li>Open a web browser and go to http://&lt;machine-name&gt;/ to open Sawmill.</li>
          <li>Verify you can login using your PDS username and password.</li>
        </ol>
      </subsection>

    </section>
  </body>
</document>
